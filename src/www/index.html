<!DOCTYPE html>
<html>
  <head>
    <title>Kiosk: Administration</title>
    <script language="javascript" type="text/javascript" src="./js/lib/jquery.min.js"></script>
    <script type="text/javascript">
      $(function(){
        var address = location.hostname+(location.port ? ':'+location.port: '');
        var data;

        $("#logout").attr('href','http://log:out@'+address);

        $.getJSON("http://"+address+'/data',function(d){
          data = d;
          console.log(data);
          $('#url').val(data.url);
          $('#username').val(data.username);
          $('body').removeClass('loading');
        });

        $('form').submit(function(e){
          e.preventDefault();
          var error = [];
          var url = $('#url').val();
          var username = $("#username").val();
          var password = $("#password").val();
          var passwordConfirm = $("#confirm_password").val();
          if(url && (url.indexOf("http://") >= 0 || url.indexOf("https://") >= 0 )){
            //url is valid
          }else{
            error.push("URL must be specified.");
          }
          if(password && password != passwordConfirm){
            error.push("Passwords must match.");
          }

          if(error.length){
            var h = "";
            for(var i = 0; i < error.length; i++){
              h += '<p>'+error[i]+'</p>';
            }
            $('#error').html(h);
            return false;
          }else{
            //ready to reload
            $('body').addClass('loading');
            $('#loading').text('Saving...');
            var newData = {};
            if(username != data.username) newData['username'] = username;
            if(password && password != data.password) newData['password'] = password;
            if(url != data.url) newData['url'] = url;
            $.ajax({
              url: "http://"+address+'/data',
              type: 'PUT',
              data: newData,
              success: function(){
                window.location.reload();
              }
            })
          }
        });

      })
    </script>
    <style type="text/css">
    .disabled{
      display:none;
      visibility:hidden;
    }
    #loading{
      display:none;
      visibility:hidden;
    }
    body.loading #loading{
      display:block;
      visibility:visible;
    }
    body.loading #settings{
      display:none;
      visibility:hidden;
    }
    </style>
  </head>
  <body style="text-align:center;" class="loading">
      <div id="error"></div>
      <h1>Administration</h1>
      <a id="logout" href="#">Log out.</a>
      <div id="loading"><h2>Loading...</h2></div>
      <div id="settings">
        <form>
          <p>
            <label><strong>Content URL:</strong></label><br>
            URL must include "http://" or "https://"<br>
            <input id="url" placeholder="http://" size="80">
          </p>
          <p>
            <label><strong>Remote Administration:</strong></label><br>
              Username:  <input id="username" value=""/><br>
              Password:  <input type="password" id="password" value=""/><br>
              Confirm Password:  <input type="password" id="confirm_password" value=""/><br>
            <input id="save" type="submit" value="Save"><br>
            Kiosk application will restart upon saving.
          </p>
        </form>
      </div>
  </body>
</html>
